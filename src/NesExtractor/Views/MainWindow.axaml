<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:NesExtractor.ViewModels"
        xmlns:views="using:NesExtractor.Views"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:l="using:NesExtractor.Localization"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
        x:Class="NesExtractor.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding Title}"
        Width="1000" Height="700"
        MinWidth="800" MinHeight="600">

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <DockPanel>
        <!-- Menu -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="{l:Loc Menu.File}">
                <MenuItem Header="{l:Loc Menu.File.Open}" Command="{Binding OpenFileCommand}" InputGesture="Ctrl+O">
                    <MenuItem.Icon>
                        <PathIcon Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="{l:Loc Menu.File.CloseTab}" Command="{Binding CloseCurrentTabCommand}" InputGesture="Ctrl+W" />
                <Separator />
                <MenuItem Header="{l:Loc Menu.File.Exit}" Command="{Binding ExitCommand}" InputGesture="Ctrl+Q">
                    <MenuItem.Icon>
                        <PathIcon Data="M19,3H5C3.89,3 3,3.89 3,5V9H5V5H19V19H5V15H3V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M10.08,15.58L11.5,17L16.5,12L11.5,7L10.08,8.41L12.67,11H3V13H12.67L10.08,15.58Z" />
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="{l:Loc Menu.Help}">
                <MenuItem Header="{l:Loc Menu.Help.About}" Command="{Binding ShowAboutCommand}">
                    <MenuItem.Icon>
                        <PathIcon Data="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z" />
                    </MenuItem.Icon>
                </MenuItem>
                <Separator />
                <MenuItem Header="{l:Loc Menu.Language}">
                    <MenuItem Header="{l:Loc Menu.Language.English}" Command="{Binding SetLanguageEnglishCommand}" />
                    <MenuItem Header="{l:Loc Menu.Language.Russian}" Command="{Binding SetLanguageRussianCommand}" />
                </MenuItem>
            </MenuItem>
        </Menu>

        <!-- Error message bar -->
        <Border DockPanel.Dock="Top" 
                Background="#FFFFE0C0"
                Padding="12,8"
                IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
            <DockPanel>
                <Button DockPanel.Dock="Right" 
                        Content="✕" 
                        Command="{Binding ClearErrorCommand}"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="8,4" />
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <PathIcon Data="M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z"
                              Width="20" Height="20"
                              Foreground="#FF8B4513" />
                    <TextBlock Text="{Binding ErrorMessage}" 
                               VerticalAlignment="Center"
                               TextWrapping="Wrap" />
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- Основная область контента -->
        <Grid>
            <!-- Tab Control -->
            <TabControl ItemsSource="{Binding Tabs}"
                        SelectedItem="{Binding SelectedTab}"
                        IsVisible="{Binding Tabs.Count}">
                <TabControl.ItemTemplate>
                    <DataTemplate>
                        <DockPanel LastChildFill="True">
                            <Button DockPanel.Dock="Right"
                                    Classes="tab-close-button"
                                    Content="×"
                                    Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).CloseTabCommand}"
                                    CommandParameter="{Binding}"
                                    ToolTip.Tip="{l:Loc Tabs.Close.Tooltip}" />
                            <StackPanel Orientation="Horizontal" Spacing="0">
                                <PathIcon Classes="tab-icon"
                                          Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                                <TextBlock Classes="tab-text"
                                           Text="{Binding FileName}" />
                            </StackPanel>
                        </DockPanel>
                    </DataTemplate>
                </TabControl.ItemTemplate>
                <TabControl.ContentTemplate>
                    <DataTemplate>
                        <views:FileTabView />
                    </DataTemplate>
                </TabControl.ContentTemplate>
            </TabControl>

            <!-- Empty state when no tabs -->
            <Border IsVisible="{Binding !Tabs.Count}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="24" MaxWidth="400">
                <PathIcon Classes="empty-state-icon"
                          Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                <StackPanel Spacing="8" HorizontalAlignment="Center">
                    <TextBlock Text="{l:Loc Empty.Welcome.Title}"
                               FontSize="22"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{l:Loc Empty.Welcome.Subtitle}"
                               FontSize="14"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                               TextWrapping="Wrap"
                               TextAlignment="Center"
                               Margin="0,0,0,8" />
                </StackPanel>
                <Border Classes="info-panel" Padding="20,16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="{l:Loc Empty.Features.1}" FontSize="13" />
                        <TextBlock Text="{l:Loc Empty.Features.2}" FontSize="13" />
                        <TextBlock Text="{l:Loc Empty.Features.3}" FontSize="13" />
                        <TextBlock Text="{l:Loc Empty.Features.4}" FontSize="13" />
                    </StackPanel>
                </Border>
                <Button Classes="export-button"
                        Content="{l:Loc Empty.OpenButton}" 
                        Command="{Binding OpenFileCommand}"
                        HorizontalAlignment="Center"
                        Padding="24,12"
                        FontSize="15" />
                <TextBlock Text="{l:Loc Empty.OpenHint}"
                           FontSize="12"
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Border>
        </Grid>
    </DockPanel>
</Window>

